---
name: fix-comment-rules
description: src/とe2e/内のコメント規約違反を一括修正する
disable-model-invocation: true
allowed-tools: Bash, Read, Write, Edit, Grep, Glob, Task
---

# コメント規約違反の一括修正

## Mission

`src/`と`e2e/`内のすべてのコードのコメントが[comment-rules.md](comment-rules.md)のルールに従っているかを確認し、違反しているコメントを削除または修正する。

## Success Criteria

- すべての`.ts`、`.tsx`ファイルのコメントを確認
- 規約違反のコメントを削除または修正
- 修正のサマリーをユーザーに提示

## Core Task

`src/`と`e2e/`内のすべてのTypeScript/TSXファイルのコメントを確認し、[comment-rules.md](comment-rules.md)のルールに違反しているコメントを削除または規約を満たすように修正する。

**重要**: すべてのコメントを確認する作業は作業量が多いからといってサボってはいけない。ファイルごとにエージェントを起動してすべてのファイルについて並列に実行すること。

## Execution Steps

### Step 1: コメント規約の読み込み

[comment-rules.md](comment-rules.md)を読み込み、コメント規約を理解する。

### Step 2: 対象ファイルの特定

以下のGlobパターンで対象ファイルを特定する:
- `src/**/*.ts`
- `src/**/*.tsx`
- `e2e/**/*.ts`

### Step 3: 並列エージェント実行

**各ファイルに対してエージェントを起動**:
- Task toolを使用してsubagent_type="general-purpose"でエージェントを起動
- **重要**: 可能な限り多くのエージェントを**並列**に起動する（単一のメッセージで複数のTask tool呼び出しを行う）
- 各エージェントに以下のプロンプトを渡す:

```
あなたは {file-path} のコメント規約チェッカーです。

## タスク
1. ファイルを読み込む
2. ファイル内のすべてのコメントを特定する
3. 各コメントについて .claude/skills/fix-comment-rules/comment-rules.md のルールに従っているか判定する
4. 違反しているコメントを削除するか、規約を満たすように書き直す

## 判定フロー
comment-rules.md の判定ステップ1〜20に従って各コメントを判定する。

## 出力形式
以下の形式でJSONを返す（マークダウンコードブロックなしで純粋なJSONのみ）:
{
  "file": "{file-path}",
  "totalComments": <確認したコメント数>,
  "violations": [
    {
      "line": <行番号>,
      "original": "<元のコメント>",
      "action": "deleted" | "modified",
      "modified": "<修正後のコメント（修正した場合のみ）>",
      "reason": "<違反理由>"
    }
  ],
  "modified": <true/false - ファイルを修正したかどうか>
}

違反がない場合は violations を空配列にする。

## 重要
- すべてのコメントを確認すること（1つも見逃さない）
- 許可されているコメントは削除・修正しないこと
- 判定に迷う場合はステップ20（未分類）として報告すること
```

### Step 4: 結果の集約とサマリー作成

すべてのエージェントの結果を収集し、以下のサマリーを作成:

1. **全体統計**:
   - 確認したファイル数
   - 確認したコメント総数
   - 違反が見つかったファイル数
   - 削除したコメント数
   - 修正したコメント数

2. **ファイルごとの詳細**（修正があったファイルのみ）:
   - ファイルパス
   - 削除/修正したコメントの内容と理由

3. **未分類コメント**（ステップ20に該当するもの）:
   - ファイルパス
   - 行番号
   - コメント内容
   - 判定できなかった理由

## 重要な制約事項

- **サボり禁止**: ファイル数が多くても、すべてのファイルを確認すること
- **並列実行**: 効率のため、可能な限り多くのエージェントを並列に起動すること
- **正確な判定**: comment-rules.mdの判定フローに厳密に従うこと
- **許可コメントの保持**: 許可されているコメントは削除・修正しないこと
- **日本語での応答**: すべての出力は日本語で行うこと

## Output Format

**初期ステータス**:
```
コメント規約チェックを開始します

対象ディレクトリ: src/, e2e/
対象ファイル数: {count} 件

ファイルごとにエージェントを並列起動中...
```

**最終サマリー**:
```
コメント規約チェックが完了しました

全体統計:
- 確認ファイル数: {count}
- 確認コメント数: {count}
- 違反ファイル数: {count}
- 削除コメント数: {count}
- 修正コメント数: {count}

修正したファイル:
{ファイルごとの詳細}

未分類コメント（要確認）:
{未分類コメントの詳細}
```

## Error Handling

**comment-rules.mdが見つからない場合**:
- **実行停止**: 規約ファイルが必須
- **メッセージ**: 「comment-rules.md が見つかりません」

**対象ファイルがない場合**:
- **正常終了**: チェック対象なし
- **メッセージ**: 「src/ と e2e/ に対象ファイルがありません」

**エージェント実行エラー**:
- **継続**: 他のファイルのチェックは続行
- **報告**: エラーが発生したファイルをサマリーに含める
