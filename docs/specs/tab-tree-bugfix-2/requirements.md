# Requirements Document

## Project Description (Input)
現状の拡張機能をインストールして動作確認をしてみました。
以下の点が気になるのでそれらを修正するタスクを作ってください。

### e2eテストがまだフレーキーである
e2eテストを手元で試してみたところまだ落ちているテストがあります。

  1 failed
    [chromium] › e2e/tab-persistence.spec.ts:201:5 › Task 2.4: Tab Persistence › Requirement 1.3: タイトルの永続化更新 › タブ内でのページ遷移時にタイトルの永続化データが更新されること

これらのテストについてフレーキーさがなくなるまでテストを修正し、フレーキーでないことをちゃんと確認しなさい。

### タブとタブの隙間へのドロップが正しくない
タブとタブの隙間にドロップするとブラウザのデフォルトのタブは並び替わるが、ツリービューのタブが並び変わらない。
また、ブラウザのタブの並び替えについても、ドロップしたものがどの隙間にドロップしても先頭に移動してしまう。
タブとタブの隙間にドロップしたときに正しい位置にツリービュー上でタブが移動していることを確認しなさい。

### タブドラッグ時にタブの縦スクロールが必要以上のスクロールができてしまう
タブドラッグ時のスクロールは現状のタブがタブツリー全体の量より大きい場合に、そのスクロール可能量だけスクロールするようにしなさい。
本来のスクロール量以上にスクロールできるdnd-kitの挙動から変更する必要があるかもしれません。

### ツリービューからのドラッグアウトの判定がおかしい
タブツリーのタブが少ないとき、タブの下の方にあるサイドパネルの領域にタブを動かすと新しいタブが開きます。
サイドパネルから外にドラッグアウトしたときだけ新しいタブが開くようにしなさい。

### タブのグループ化が全く動いていない
右クリックのコンテキストメニューからのタブのグループ化が動いていません。
グループ化したら選択中のタブの親タブが生成されて親タブの下に選択していたタブが子タブとして配置されるように修正してその挙動を確認しなさい。
ちゃんとツリー型タブ上で親タブが存在するかもe2eテストで確認しなさい。
親となるグループタブ用の拡張機能専用タブが生成されるコードがそもそも存在するかを確認しなさい。

### 別ウィンドウからタブをドラッグしてこれない
別のウィンドウでタブをドラッグして、新しいウィンドウのツリービューにマウスを重ねたら、その新しいウィンドウの方にドラッグ中のタブを移動して、そのままそっちのツリーの上にドロップできるようにしなさい。
現状では全てドラッグアウトと判定されて新しいウィンドウが開いてしまいます。
元のウィンドウにタブをマージすることができません。

### ドラッグアウトしてタブが無くなったウィンドウは自動的に閉じるべき
ドラッグアウトでタブを全て移動させたウィンドウは自動的に閉じるようにしなさい。
現状では何もタブがないウィンドウが残り続けてしまいます。

### 新しいタブの追加ボタンに「新規タブ」という文字があるのが邪魔
新しいタブ追加ボタンは「+」だけ表示されていて文字は必要ありません。

### ビューのアイコンをプリセットから選んでも変わらない
ビューのアイコンの選択はSelectボタンを幼くても選択したらすぐに反映されるようにしなさい。
そして、現状ではプリセットからアイコンを選んでもツリービューパネル上のアイコンが変更しないので修正しなさい。

### ビューを追加しても新しいタブをそのビューに追加できない
ビューを追加まではできるが、そのビューを開いた状態で新しいタブを開いてもそのビューが閉じてしまって元のビューに新しいタブが追加されてしまう。
これを新しいビューを開いていたら、現在開いているビューに対して新しいタブを追加しなさい。

### 新しいタブのタブタイトルの名前が間違っている
新しいタブのタブタイトルがちゃんとスタートページというタイトルになるようにしなさい。

### 新規タブボタンで追加される新しいタブがVivaldiのスタートページじゃない
ブラウザ本体から新しいタブを開くと次のようなURLが開きます。
chrome://vivaldi-webui/startpage?section=Speed-dials&background-color=#2e2f37
一方でツリービューの新規タブで開くと
chrome://newtab/
というタブが開かれていてVivaldiのスタートページではありません。
修正しなさい。

### 未読インジケーターの位置が右端じゃない
未読インジケーターがタイトルが短い場合にそのタイトルの末尾になってしまっている。
未読インジケーターはタイトルの長さによらずタブの右端に表示するべきです。

### ブラウザを開き直したときにファビコンが復元されない
ブラウザを開き直したらタブをロードしていなくても永続化されていたファビコンが表示され直すべきです。
修正しなさい。

### タブを選択状態で他の操作をしてもタブの選択が解除されない
タブをShiftクリックとかで複数選択してその状態で新しいタブを開いたりしても選択が解除されないのがおかしいです。
新しいタブを開くとか、その他操作をしたら選択状態は解除されるべきです。

### タブを複製すると子タブになってしまう
複製したタブは子タブではなく兄弟タブとしてツリー型タブの複製されるタブの１個下に表示されるようにしなさい。

### 新しく開かれるタブの挙動がおかしい
設定画面を開くと現在のタブの子タブとして開かれますが、設定画面は独立した画面なので子タブではない開かれ方をするべきだと思います。
子タブとして開かれるべきはリンククリックとかで開かれるページだけで、その他のタブを開く手順ではツリーの最後とかに開かれるべきです。
タブの動作の設定画面に「デフォルトの新しいタブの位置」と「リンククリックのタブの位置」と「手動で開かれたタブの位置」がありますが、既定では設定は「リンククリックから開かれたタブの位置」だけ「元のタブの子」としてそうではないものはリストの最後にしてください。
またデフォルトの設定は必要なく、個別に設定できればよいです。
手動で開かれたタブの位置の設定がちゃんと反映されているかもテストで確認しなさい。
手動で開かれたタブの位置を現在のタブの子と設定してもその設定が反映されていない場合があるのも気になります。
タブの開かれる位置についてe2eテストを拡充して上記シナリオやそれ以外のシナリオについてバグを確認し、修正をしなさい。

## Introduction
本ドキュメントは、Vivaldi-TT（ツリー型タブマネージャー）拡張機能における複数のバグ修正および機能改善の要件を定義します。動作確認時に発見された問題点を系統的に修正し、ユーザー体験の向上を目指します。

すべての修正内容について、E2Eテストが可能なものは可能な限りE2Eテストで検証し、将来のリグレッションを検知できるようにします。各E2Eテストはフレーキーでないこと、および実行時間が最適化されていることを必須条件とします。

## Requirements

### Requirement 1: E2Eテストの安定化
**Objective:** ユーザーとして、信頼性の高いテストスイートを維持したい。これにより、リグレッションを早期に検出し、コード品質を保証できます。

#### Acceptance Criteria
1. When `tab-persistence.spec.ts:201:5`のテストが実行されたとき, the E2Eテストスイート shall 10回連続でテストがパスすること
2. The E2Eテストスイート shall `--repeat-each=10`オプションで全テストが100%パスすること
3. If テストが失敗する場合, the テストコード shall ポーリングユーティリティを使用して状態変化を待機すること（固定時間待機禁止）
4. The 修正されたE2Eテスト shall `--repeat-each=10`で10回連続成功すること
5. The E2Eテスト shall 最適な実行時間で完了すること（不要な待機時間を含まないこと）

### Requirement 2: タブ間ドロップ位置の修正
**Objective:** ユーザーとして、タブをドラッグして任意の位置にドロップしたい。これにより、直感的にタブを並び替えられます。

#### Acceptance Criteria
1. When タブがタブとタブの隙間にドロップされたとき, the ツリービュー shall ドロップした位置にタブを配置すること
2. When タブがドロップされたとき, the ブラウザタブ shall ドロップ位置に対応した正しいインデックスに移動すること
3. The ツリービューのタブ順序 shall ブラウザのタブ順序と同期していること
4. The E2Eテスト shall タブ間ドロップ位置の正確性を検証すること
5. The E2Eテスト shall `--repeat-each=10`で10回連続成功し、最適な実行時間で完了すること

### Requirement 3: ドラッグ時スクロール制限
**Objective:** ユーザーとして、ドラッグ中のスクロールが適切な範囲に制限されてほしい。これにより、意図しない過剰スクロールを防げます。

#### Acceptance Criteria
1. While タブをドラッグ中, the スクロールコンテナ shall タブツリー全体の高さまでしかスクロールできないこと
2. The 自前D&D実装 shall スクロール可能量を超えるスクロールを防止すること
3. The E2Eテスト shall ドラッグ時のスクロール制限を検証すること
4. The E2Eテスト shall `--repeat-each=10`で10回連続成功し、最適な実行時間で完了すること

### Requirement 3.1: dnd-kit削除と自前D&D実装
**Objective:** 開発者として、クロスウィンドウドラッグをシームレスに実現するため、dnd-kitを削除して自前のドラッグ&ドロップ実装に切り替えたい。これにより、プログラマティックなドラッグ開始が可能になり、ウィンドウ間でのドラッグ状態継続が実現できます。

#### 段階的移行フェーズ
リスク軽減のため、dnd-kitから自前実装への移行は3フェーズに分割して段階的に実施します：

**Phase 1: 基盤実装とTabTreeView移行**
- useDragDrop、useAutoScroll、DragOverlayの新規実装
- 単体テストによる基盤検証
- TabTreeViewのみを自前実装に移行
- 関連E2Eテスト（drag-drop-reorder, drag-drop-insert, drag-drop-hierarchy等）の修正

**Phase 2: PinnedTabsSection移行**
- PinnedTabsSectionを自前実装に移行（水平ドラッグ対応）
- 関連E2Eテストの修正

**Phase 3: TabTreeViewWithGroups移行とdnd-kit完全削除**
- TabTreeViewWithGroupsを自前実装に移行
- クロスウィンドウドラッグ機能の実装
- dnd-kitライブラリの完全削除
- 全E2Eテストの最終検証

#### スコープ外
- **タッチイベント対応**: 今回の実装ではタッチイベント（touchstart/touchmove/touchend）はスコープ外とします。マウス操作（mousedown/mousemove/mouseup）のみをサポートします。タッチ対応は将来の拡張として検討します。

#### Acceptance Criteria
1. The 拡張機能 shall dnd-kitライブラリ（@dnd-kit/core, @dnd-kit/sortable, @dnd-kit/utilities, dnd-kit-sortable-tree）を完全に削除すること
2. The 自前D&D実装 shall mousedown/mousemove/mouseupイベントでドラッグ操作を処理すること
3. The 自前D&D実装 shall ドラッグ開始時に8px以上の移動を検知してからドラッグを開始すること（誤操作防止）
4. The 自前D&D実装 shall ドラッグ中の要素をマウスカーソルに追従させること
5. The 自前D&D実装 shall 既存のGapDropDetection.tsのロジックを流用してドロップ位置を計算すること
6. The 自前D&D実装 shall クロスウィンドウでのドラッグ状態継続を可能にすること
7. The dnd-kit互換性 shall 一切残さないこと（技術的負債の回避）
8. The 影響を受けるE2Eテスト shall 自前実装に合わせて個別に修正すること
9. The 移行 shall 3フェーズに分割して段階的に実施すること（各フェーズで動作確認を行い、リスクを軽減）
10. The 自前D&D実装 shall タッチイベントには対応せず、マウス操作のみをサポートすること

### Requirement 3.2: dnd-kit削除に伴うE2Eテスト修正
**Objective:** 開発者として、dnd-kit削除後もE2Eテストが正常に動作することを保証したい。互換性レイヤーは設けず、各テストを自前実装に合わせて修正します。

#### 影響を受けるE2Eテストファイル
以下のテストファイルは自前D&D実装への移行に伴い、修正が必要です：

**ドラッグ&ドロップ関連テスト:**
- `e2e/drag-drop-reorder.spec.ts`
- `e2e/drag-drop-insert.spec.ts`
- `e2e/drag-drop-hierarchy.spec.ts`
- `e2e/drag-drop-complex.spec.ts`
- `e2e/drag-drop-external.spec.ts`
- `e2e/drag-drop-placeholder.spec.ts`
- `e2e/drag-drop-hover.spec.ts`
- `e2e/drag-drop-scroll.spec.ts`
- `e2e/drag-drop-improvements.spec.ts`
- `e2e/drag-drop-child-independent.spec.ts`
- `e2e/drag-tab-size-stability.spec.ts`
- `e2e/gap-drop-accuracy.spec.ts`

**クロスウィンドウ関連テスト:**
- `e2e/cross-window-drag-drop.spec.ts`
- `e2e/cross-window-drag-indicator.spec.ts`

**ユーティリティ:**
- `e2e/utils/drag-drop-utils.ts`（ドラッグ操作ヘルパー）
- `e2e/utils/drag-drop-utils.spec.ts`

#### Acceptance Criteria
1. The 各E2Eテストファイル shall 自前D&D実装の動作に合わせて修正されること
2. The E2Eテスト shall dnd-kit固有の属性やセレクタ（存在する場合）を自前実装の属性に置き換えること
3. The 修正後のE2Eテスト shall `--repeat-each=10`で10回連続成功すること
4. The E2Eテスト shall dnd-kitへの依存を一切含まないこと

### Requirement 4: ドラッグアウト判定の修正
**Objective:** ユーザーとして、サイドパネル外にドラッグしたときだけ新規ウィンドウが作成されてほしい。これにより、誤操作による新規ウィンドウ作成を防げます。

#### Acceptance Criteria
1. When タブがサイドパネル外にドラッグされたとき, the 拡張機能 shall 新規ウィンドウを作成してタブを移動すること
2. When タブがサイドパネル内の空白領域（タブツリー下部）にドラッグされたとき, the 拡張機能 shall 新規ウィンドウを作成しないこと
3. The ドラッグアウト判定 shall サイドパネルの境界を基準とすること（タブツリーの高さではなく）
4. The E2Eテスト shall ドラッグアウト判定の正確性を検証すること（サイドパネル内外の両ケース）
5. The E2Eテスト shall `--repeat-each=10`で10回連続成功し、最適な実行時間で完了すること

### Requirement 5: タブグループ化機能の修正
**Objective:** ユーザーとして、選択したタブをグループ化したい。これにより、関連するタブを整理できます。

#### Acceptance Criteria
1. When コンテキストメニューから「グループ化」が選択されたとき, the 拡張機能 shall 親となるグループタブを新規作成すること
2. When グループ化が実行されたとき, the 選択されていたタブ shall 新規作成されたグループタブの子タブとして配置されること
3. The グループタブ shall 実際のブラウザタブとして作成されること（仮想タブIDではなく実タブ）
4. The グループタブ shall 拡張機能専用ページ（`chrome-extension://`スキームのURL）として作成されること
5. The グループタブ shall グループ管理用のUIを表示する拡張機能専用ページであること
6. The グループタブ shall chrome.tabs.create APIで作成され、実際のタブIDを持つこと
7. The グループ作成処理 shall 同期的に実行されること（軽量な処理のため順序保証に特別な仕組みは不要）
8. The グループタブページ shall ポーリングによりツリー状態の更新を監視し、子タブリストを逐一更新すること
9. The グループタブページ shall グループ情報取得中にローディング表示を行うこと
10. The グループタブページ shall グループ情報が取得できない場合に適切なエラー/リトライUIを表示すること
11. The E2Eテスト shall グループタブのURLが拡張機能専用ページであることを検証すること
12. The E2Eテスト shall グループ化後に親タブの存在を検証すること
13. The E2Eテスト shall グループ化後の親子関係を検証すること
14. The E2Eテスト shall `--repeat-each=10`で10回連続成功し、最適な実行時間で完了すること

### Requirement 6: クロスウィンドウドラッグの実装
**Objective:** ユーザーとして、別ウィンドウからタブをドラッグして移動したい。これにより、ウィンドウ間でタブを効率的に整理できます。

#### Acceptance Criteria
1. When 別ウィンドウでドラッグ中のタブが新しいウィンドウのツリービューにホバーされたとき, the 拡張機能 shall タブを新しいウィンドウに移動すること
2. When クロスウィンドウドラッグが発生したとき, the 拡張機能 shall ドロップ位置に応じてツリーにタブを配置すること
3. The クロスウィンドウドラッグ shall ドラッグアウトとして判定されないこと
4. When ドラッグ中のタブが新しいウィンドウのツリービューに入ったとき, the 元のウィンドウ shall タブをタブツリーから削除すること
5. When ドラッグ中のタブが新しいウィンドウのツリービューに入ったとき, the 新しいウィンドウ shall タブをタブツリーに追加してドラッグ状態で表示すること
6. The ドラッグ中のタブ shall ウィンドウ間を移動したように見えること（シームレスなUX）
7. If Service Worker接続エラーが発生した場合, the ドラッグ操作 shall サイレントにキャンセルされること（エラー通知は不要）
8. The E2Eテスト shall クロスウィンドウドラッグ機能を検証すること
9. The E2Eテスト shall `--repeat-each=10`で10回連続成功し、最適な実行時間で完了すること

### Requirement 7: 空ウィンドウの自動クローズ
**Objective:** ユーザーとして、タブがなくなったウィンドウは自動的に閉じてほしい。これにより、不要なウィンドウが残りません。

#### Acceptance Criteria
1. When ドラッグアウトにより全てのタブが移動されたとき, the 元のウィンドウ shall 自動的に閉じること
2. If ウィンドウにタブが残っている場合, the ウィンドウ shall 開いたまま維持されること
3. The E2Eテスト shall 空ウィンドウの自動クローズを検証すること
4. The E2Eテスト shall `--repeat-each=10`で10回連続成功し、最適な実行時間で完了すること

### Requirement 8: 新規タブボタンの簡素化
**Objective:** ユーザーとして、新規タブボタンはシンプルな「+」アイコンだけであってほしい。これにより、UIがすっきりします。

#### Acceptance Criteria
1. The 新規タブボタン shall 「+」アイコンのみを表示すること
2. The 新規タブボタン shall 「新規タブ」というテキストラベルを表示しないこと

### Requirement 9: ビューアイコン選択の即時反映
**Objective:** ユーザーとして、ビューアイコンを選択したらすぐに反映されてほしい。これにより、設定の確認が容易になります。

#### Acceptance Criteria
1. When プリセットからアイコンが選択されたとき, the ビューアイコン shall 即座に更新されること
2. When アイコンが選択されたとき, the ツリービューパネル上のアイコン shall 変更を反映すること
3. The アイコン選択 shall 「Select」ボタンの押下を必要としないこと
4. The E2Eテスト shall ビューアイコン選択の即時反映を検証すること
5. The E2Eテスト shall `--repeat-each=10`で10回連続成功し、最適な実行時間で完了すること

### Requirement 10: ビューへの新規タブ追加
**Objective:** ユーザーとして、開いているビューに新しいタブを追加したい。これにより、ビューの切り替えなしでタブを追加できます。

#### Acceptance Criteria
1. When 新規タブが作成されたとき, the タブ shall 現在開いているビューに追加されること
2. When ビューを開いた状態で新規タブを追加したとき, the ビュー shall 閉じずに維持されること
3. The 新規タブ shall 元のデフォルトビューではなく、現在アクティブなビューに属すること
4. The E2Eテスト shall ビューへの新規タブ追加を検証すること
5. The E2Eテスト shall `--repeat-each=10`で10回連続成功し、最適な実行時間で完了すること

### Requirement 11: 新規タブのタイトル修正
**Objective:** ユーザーとして、新規タブのタイトルが正しく表示されてほしい。これにより、タブの識別が容易になります。

#### Acceptance Criteria
1. When 新規タブが作成されたとき, the タブタイトル shall 「スタートページ」と表示されること
2. The タブタイトル shall Vivaldiブラウザのスタートページのタイトルと一致すること
3. The E2Eテスト shall 新規タブのタイトル表示を検証すること
4. The E2Eテスト shall `--repeat-each=10`で10回連続成功し、最適な実行時間で完了すること

### Requirement 12: 新規タブURLのVivaldiスタートページ対応
**Objective:** ユーザーとして、新規タブでVivaldiのスタートページを開きたい。これにより、ブラウザ標準の動作と一致します。

#### Acceptance Criteria
1. When ツリービューの新規タブボタンがクリックされたとき, the 新規タブ shall `chrome://vivaldi-webui/startpage`を開くこと
2. The 新規タブURL shall `chrome://newtab/`ではなく、Vivaldiスタートページであること
3. The E2Eテスト shall 新規タブのURLを検証すること
4. The E2Eテスト shall `--repeat-each=10`で10回連続成功し、最適な実行時間で完了すること

### Requirement 13: 未読インジケーター位置の修正
**Objective:** ユーザーとして、未読インジケーターがタブの右端に固定されてほしい。これにより、視認性が向上します。

#### Acceptance Criteria
1. The 未読インジケーター shall タブの右端に固定表示されること
2. The 未読インジケーター位置 shall タイトルの長さに依存しないこと
3. The E2Eテスト shall 未読インジケーターの位置を検証すること（短いタイトル、長いタイトル両方）
4. The E2Eテスト shall `--repeat-each=10`で10回連続成功し、最適な実行時間で完了すること

### Requirement 14: ファビコンの永続化復元
**Objective:** ユーザーとして、ブラウザ再起動後もファビコンが表示されてほしい。これにより、タブの識別が即座に可能になります。

#### Acceptance Criteria
1. When ブラウザが再起動されたとき, the ファビコン shall 永続化データから復元されて表示されること
2. While タブがロードされていない状態, the ファビコン shall 永続化されていた画像を表示すること
3. The E2Eテスト shall ファビコンの永続化と復元を検証すること
4. The E2Eテスト shall `--repeat-each=10`で10回連続成功し、最適な実行時間で完了すること

### Requirement 15: 選択状態の自動解除
**Objective:** ユーザーとして、操作後にタブの選択が自動解除されてほしい。これにより、予期しない一括操作を防げます。

#### Acceptance Criteria
1. When 新しいタブが開かれたとき, the タブ選択状態 shall 解除されること
2. When その他の操作（タブクローズ、アクティブタブ変更等）が実行されたとき, the タブ選択状態 shall 解除されること
3. The E2Eテスト shall 各種操作後のタブ選択状態解除を検証すること
4. The E2Eテスト shall `--repeat-each=10`で10回連続成功し、最適な実行時間で完了すること

### Requirement 16: タブ複製時の配置修正
**Objective:** ユーザーとして、複製したタブが兄弟タブとして配置されてほしい。これにより、ツリー構造が乱れません。

#### Acceptance Criteria
1. When タブが複製されたとき, the 複製されたタブ shall 元のタブの兄弟として配置されること
2. When タブが複製されたとき, the 複製されたタブ shall 元のタブの直下（1つ下）に表示されること
3. The 複製されたタブ shall 元のタブの子タブとして配置されないこと
4. The E2Eテスト shall タブ複製時の配置を検証すること
5. The E2Eテスト shall `--repeat-each=10`で10回連続成功し、最適な実行時間で完了すること

### Requirement 17: 新規タブ位置設定の修正
**Objective:** ユーザーとして、タブの開かれ方に応じて位置を設定したい。これにより、ワークフローに合わせた動作をカスタマイズできます。

#### Acceptance Criteria
1. When リンククリックでタブが開かれたとき, the 新規タブ shall 「リンククリックのタブの位置」設定に従って配置されること
2. When 手動でタブが開かれたとき（新規タブボタン、設定画面など）, the 新規タブ shall 「手動で開かれたタブの位置」設定に従って配置されること
3. The デフォルト設定 shall 「リンククリックのタブの位置」を「元のタブの子」、その他を「リストの最後」とすること
4. The 設定画面 shall 「デフォルトの新しいタブの位置」設定を削除すること
5. When 「手動で開かれたタブの位置」が「現在のタブの子」に設定されたとき, the 新規タブ shall 確実にその設定に従って配置されること
6. The システムページ判定 shall chrome://、vivaldi://、chrome-extension://、about:スキームのURLを検出すること
7. The システムページ判定 shall openerTabIdがあってもシステムページの場合は手動タブとして扱うこと
8. The E2Eテスト shall タブ位置設定の各シナリオを検証すること（リンククリック、手動タブ作成、設定変更後の反映）
9. The E2Eテスト shall `--repeat-each=10`で10回連続成功し、最適な実行時間で完了すること

### Requirement 17.1: システムページタイトルの適切な表示
**Objective:** ユーザーとして、システムページのタイトルが適切に表示されてほしい。file://などでPDFを開いた場合は正しいタイトルが表示され、URLがそのままタイトルになっている場合のみフレンドリー名に置き換えられます。

#### Acceptance Criteria
1. When タブタイトルがURL形式のままである場合, the システム shall システムURLを検出してフレンドリー名に置き換えること
2. When タブタイトルがURL形式ではない場合（例：PDFファイル名）, the システム shall タイトルをそのまま表示すること
3. The タイトル判定 shall タイトル文字列がURL形式（スキーム://で始まる）かどうかを判定すること
4. The フレンドリー名 shall chrome://settings → 「設定」、vivaldi://settings → 「設定」などの対応を持つこと
5. The file://スキーム shall タイトルがURLのままの場合のみファイル名に置き換え、タイトルが既に設定されている場合はそのまま表示すること

### Requirement 18: E2Eテスト品質基準
**Objective:** 開発者として、全てのE2Eテストが信頼性高く、効率的に実行されることを保証したい。これにより、CI/CDパイプラインの安定性と開発効率が向上します。

#### Acceptance Criteria
1. The 新規追加されたE2Eテスト shall `--repeat-each=10`で10回連続成功すること
2. The E2Eテスト shall 固定時間待機（`waitForTimeout`）を使用せず、ポーリングで状態確定を待機すること
3. The E2Eテスト shall 各テストケースが必要十分な短い時間で完了すること
4. If テストが異常に長い実行時間を要する場合, the テストコード shall 原因を調査し根本解決すること
5. The E2Eテスト shall `e2e/utils/polling-utils.ts`のユーティリティを活用すること
6. The テスト完了前 shall `npx playwright test --repeat-each=10`で安定性を検証すること
